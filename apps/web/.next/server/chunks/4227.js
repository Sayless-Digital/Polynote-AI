"use strict";exports.id=4227,exports.ids=[4227],exports.modules={44227:(a,b,c)=>{c.d(b,{analyzeNote:()=>L});var d=c(35165),e=c(55091),f=c(67392),g=f.Ik({error:f.Ik({code:f.ai().nullable(),message:f.Yj(),status:f.Yj()})}),h=(0,d.sl)({errorSchema:g,errorToMessage:a=>a.error.message}),i=f.Ik({outputDimensionality:f.ai().optional(),taskType:f.k5(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}),j=class{constructor(a,b){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=a,this.config=b}get provider(){return this.config.provider}async doEmbed({values:a,headers:b,abortSignal:c,providerOptions:f}){let g=await (0,d.xI)({provider:"google",providerOptions:f,schema:i});if(a.length>this.maxEmbeddingsPerCall)throw new e.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:a});let j=(0,d.m2)(await (0,d.hd)(this.config.headers),b);if(1===a.length){let{responseHeaders:b,value:e,rawValue:f}=await (0,d.GU)({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:j,body:{model:`models/${this.modelId}`,content:{parts:[{text:a[0]}]},outputDimensionality:null==g?void 0:g.outputDimensionality,taskType:null==g?void 0:g.taskType},failedResponseHandler:h,successfulResponseHandler:(0,d.cV)(l),abortSignal:c,fetch:this.config.fetch});return{embeddings:[e.embedding.values],usage:void 0,response:{headers:b,body:f}}}let{responseHeaders:m,value:n,rawValue:o}=await (0,d.GU)({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:j,body:{requests:a.map(a=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:a}]},outputDimensionality:null==g?void 0:g.outputDimensionality,taskType:null==g?void 0:g.taskType}))},failedResponseHandler:h,successfulResponseHandler:(0,d.cV)(k),abortSignal:c,fetch:this.config.fetch});return{embeddings:n.embeddings.map(a=>a.values),usage:void 0,response:{headers:m,body:o}}}},k=f.Ik({embeddings:f.YO(f.Ik({values:f.YO(f.ai())}))}),l=f.Ik({embedding:f.Ik({values:f.YO(f.ai())})});function m(a){var b;if(null==a||null!=(b=a)&&"object"==typeof b&&"object"===b.type&&(null==b.properties||0===Object.keys(b.properties).length)&&!b.additionalProperties)return;if("boolean"==typeof a)return{type:"boolean",properties:{}};let{type:c,description:d,required:e,properties:f,items:g,allOf:h,anyOf:i,oneOf:j,format:k,const:l,minLength:n,enum:o}=a,p={};if(d&&(p.description=d),e&&(p.required=e),k&&(p.format=k),void 0!==l&&(p.enum=[l]),c&&(Array.isArray(c)?c.includes("null")?(p.type=c.filter(a=>"null"!==a)[0],p.nullable=!0):p.type=c:"null"===c?p.type="null":p.type=c),void 0!==o&&(p.enum=o),null!=f&&(p.properties=Object.entries(f).reduce((a,[b,c])=>(a[b]=m(c),a),{})),g&&(p.items=Array.isArray(g)?g.map(m):m(g)),h&&(p.allOf=h.map(m)),i)if(i.some(a=>"object"==typeof a&&(null==a?void 0:a.type)==="null")){let a=i.filter(a=>"object"!=typeof a||(null==a?void 0:a.type)!=="null");if(1===a.length){let b=m(a[0]);"object"==typeof b&&(p.nullable=!0,Object.assign(p,b))}else p.anyOf=a.map(m),p.nullable=!0}else p.anyOf=i.map(m);return j&&(p.oneOf=j.map(m)),void 0!==n&&(p.minLength=n),p}function n(a){return a.includes("/")?a:`models/${a}`}var o=f.Ik({responseModalities:f.YO(f.k5(["TEXT","IMAGE"])).optional(),thinkingConfig:f.Ik({thinkingBudget:f.ai().optional(),includeThoughts:f.zM().optional()}).optional(),cachedContent:f.Yj().optional(),structuredOutputs:f.zM().optional(),safetySettings:f.YO(f.Ik({category:f.k5(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:f.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:f.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:f.zM().optional(),labels:f.g1(f.Yj(),f.Yj()).optional()});function p({finishReason:a,hasToolCalls:b}){switch(a){case"STOP":return b?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var q=f.Ik({web:f.Ik({uri:f.Yj(),title:f.Yj()}).nullish(),retrievedContext:f.Ik({uri:f.Yj(),title:f.Yj()}).nullish()}),r=f.Ik({webSearchQueries:f.YO(f.Yj()).nullish(),retrievalQueries:f.YO(f.Yj()).nullish(),searchEntryPoint:f.Ik({renderedContent:f.Yj()}).nullish(),groundingChunks:f.YO(q).nullish(),groundingSupports:f.YO(f.Ik({segment:f.Ik({startIndex:f.ai().nullish(),endIndex:f.ai().nullish(),text:f.Yj().nullish()}),segment_text:f.Yj().nullish(),groundingChunkIndices:f.YO(f.ai()).nullish(),supportChunkIndices:f.YO(f.ai()).nullish(),confidenceScores:f.YO(f.ai()).nullish(),confidenceScore:f.YO(f.ai()).nullish()})).nullish(),retrievalMetadata:f.KC([f.Ik({webDynamicRetrievalScore:f.ai()}),f.Ik({})]).nullish()}),s=(0,d.hL)({id:"google.google_search",name:"google_search",inputSchema:f.Ik({mode:f.k5(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:f.ai().default(1)})}),t=f.Ik({retrievedUrl:f.Yj(),urlRetrievalStatus:f.Yj()}),u=f.Ik({urlMetadata:f.YO(t)}),v=(0,d.hL)({id:"google.url_context",name:"url_context",inputSchema:f.Ik({})}),w=class{constructor(a,b){var c;this.specificationVersion="v2",this.modelId=a,this.config=b,this.generateId=null!=(c=b.generateId)?c:d.$C}get provider(){return this.config.provider}get supportedUrls(){var a,b,c;return null!=(c=null==(b=(a=this.config).supportedUrls)?void 0:b.call(a))?c:{}}async getArgs({prompt:a,maxOutputTokens:b,temperature:c,topP:f,topK:g,frequencyPenalty:h,presencePenalty:i,stopSequences:j,responseFormat:k,seed:l,tools:n,toolChoice:p,providerOptions:q}){var r,s;let t=[],u=await (0,d.xI)({provider:"google",providerOptions:q,schema:o});(null==(r=null==u?void 0:u.thinkingConfig)?void 0:r.includeThoughts)!==!0||this.config.provider.startsWith("google.vertex.")||t.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let v=this.modelId.toLowerCase().startsWith("gemma-"),{contents:w,systemInstruction:x}=function(a,b){var c;let f=[],g=[],h=!0,i=null!=(c=null==b?void 0:b.isGemmaModel)&&c;for(let{role:b,content:c}of a)switch(b){case"system":if(!h)throw new e.b8({functionality:"system messages are only supported at the beginning of the conversation"});f.push({text:c});break;case"user":{h=!1;let a=[];for(let b of c)switch(b.type){case"text":a.push({text:b.text});break;case"file":{let c="image/*"===b.mediaType?"image/jpeg":b.mediaType;a.push(b.data instanceof URL?{fileData:{mimeType:c,fileUri:b.data.toString()}}:{inlineData:{mimeType:c,data:(0,d.ej)(b.data)}})}}g.push({role:"user",parts:a});break}case"assistant":h=!1,g.push({role:"model",parts:c.map(a=>{var b,c,f,g,h,i;switch(a.type){case"text":return 0===a.text.length?void 0:{text:a.text,thoughtSignature:null==(c=null==(b=a.providerOptions)?void 0:b.google)?void 0:c.thoughtSignature};case"reasoning":return 0===a.text.length?void 0:{text:a.text,thought:!0,thoughtSignature:null==(g=null==(f=a.providerOptions)?void 0:f.google)?void 0:g.thoughtSignature};case"file":if("image/png"!==a.mediaType)throw new e.b8({functionality:"Only PNG images are supported in assistant messages"});if(a.data instanceof URL)throw new e.b8({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:a.mediaType,data:(0,d.ej)(a.data)}};case"tool-call":return{functionCall:{name:a.toolName,args:a.input},thoughtSignature:null==(i=null==(h=a.providerOptions)?void 0:h.google)?void 0:i.thoughtSignature}}}).filter(a=>void 0!==a)});break;case"tool":h=!1,g.push({role:"user",parts:c.map(a=>({functionResponse:{name:a.toolName,response:{name:a.toolName,content:a.output.value}}}))})}if(i&&f.length>0&&g.length>0&&"user"===g[0].role){let a=f.map(a=>a.text).join("\n\n");g[0].parts.unshift({text:a+"\n\n"})}return{systemInstruction:f.length>0&&!i?{parts:f}:void 0,contents:g}}(a,{isGemmaModel:v}),{tools:y,toolConfig:z,toolWarnings:A}=function({tools:a,toolChoice:b,modelId:c}){var d;a=(null==a?void 0:a.length)?a:void 0;let f=[],g=c.includes("gemini-2"),h=c.includes("gemini-1.5-flash")&&!c.includes("-8b");if(null==a)return{tools:void 0,toolConfig:void 0,toolWarnings:f};let i=a.some(a=>"function"===a.type),j=a.some(a=>"provider-defined"===a.type);if(i&&j&&f.push({type:"unsupported-tool",tool:a.find(a=>"function"===a.type),details:"Cannot mix function tools with provider-defined tools in the same request. Please use either function tools or provider-defined tools, but not both."}),j){let b={};return a.filter(a=>"provider-defined"===a.type).forEach(a=>{switch(a.id){case"google.google_search":g?b.googleSearch={}:h?b.googleSearchRetrieval={dynamicRetrievalConfig:{mode:a.args.mode,dynamicThreshold:a.args.dynamicThreshold}}:b.googleSearchRetrieval={};break;case"google.url_context":g?b.urlContext={}:f.push({type:"unsupported-tool",tool:a,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":g?b.codeExecution={}:f.push({type:"unsupported-tool",tool:a,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;default:f.push({type:"unsupported-tool",tool:a})}}),{tools:Object.keys(b).length>0?b:void 0,toolConfig:void 0,toolWarnings:f}}let k=[];for(let b of a)"function"===b.type?k.push({name:b.name,description:null!=(d=b.description)?d:"",parameters:m(b.inputSchema)}):f.push({type:"unsupported-tool",tool:b});if(null==b)return{tools:{functionDeclarations:k},toolConfig:void 0,toolWarnings:f};let l=b.type;switch(l){case"auto":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:f};case"none":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:f};case"required":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:f};case"tool":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[b.toolName]}},toolWarnings:f};default:throw new e.b8({functionality:`tool choice type: ${l}`})}}({tools:n,toolChoice:p,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:b,temperature:c,topK:g,topP:f,frequencyPenalty:h,presencePenalty:i,stopSequences:j,seed:l,responseMimeType:(null==k?void 0:k.type)==="json"?"application/json":void 0,responseSchema:(null==k?void 0:k.type)==="json"&&null!=k.schema&&(null==(s=null==u?void 0:u.structuredOutputs)||s)?m(k.schema):void 0,...(null==u?void 0:u.audioTimestamp)&&{audioTimestamp:u.audioTimestamp},responseModalities:null==u?void 0:u.responseModalities,thinkingConfig:null==u?void 0:u.thinkingConfig},contents:w,systemInstruction:v?void 0:x,safetySettings:null==u?void 0:u.safetySettings,tools:y,toolConfig:z,cachedContent:null==u?void 0:u.cachedContent,labels:null==u?void 0:u.labels},warnings:[...t,...A]}}async doGenerate(a){var b,c,e,f,g,i,j,k,l,m,o,q;let r,{args:s,warnings:t}=await this.getArgs(a),u=JSON.stringify(s),v=(0,d.m2)(await (0,d.hd)(this.config.headers),a.headers),{responseHeaders:w,value:y,rawValue:z}=await (0,d.GU)({url:`${this.config.baseURL}/${n(this.modelId)}:generateContent`,headers:v,body:s,failedResponseHandler:h,successfulResponseHandler:(0,d.cV)(B),abortSignal:a.abortSignal,fetch:this.config.fetch}),A=y.candidates[0],C=[],D=null!=(c=null==(b=A.content)?void 0:b.parts)?c:[],E=y.usageMetadata;for(let a of D)if("executableCode"in a&&(null==(e=a.executableCode)?void 0:e.code)){let b=this.config.generateId();r=b,C.push({type:"tool-call",toolCallId:b,toolName:"code_execution",input:JSON.stringify(a.executableCode),providerExecuted:!0})}else"codeExecutionResult"in a&&a.codeExecutionResult?(C.push({type:"tool-result",toolCallId:r,toolName:"code_execution",result:{outcome:a.codeExecutionResult.outcome,output:a.codeExecutionResult.output},providerExecuted:!0}),r=void 0):"text"in a&&null!=a.text&&a.text.length>0?C.push({type:!0===a.thought?"reasoning":"text",text:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}):"functionCall"in a?C.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:a.functionCall.name,input:JSON.stringify(a.functionCall.args),providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}):"inlineData"in a&&C.push({type:"file",data:a.inlineData.data,mediaType:a.inlineData.mimeType});for(let a of null!=(f=x({groundingMetadata:A.groundingMetadata,generateId:this.config.generateId}))?f:[])C.push(a);return{content:C,finishReason:p({finishReason:A.finishReason,hasToolCalls:C.some(a=>"tool-call"===a.type)}),usage:{inputTokens:null!=(g=null==E?void 0:E.promptTokenCount)?g:void 0,outputTokens:null!=(i=null==E?void 0:E.candidatesTokenCount)?i:void 0,totalTokens:null!=(j=null==E?void 0:E.totalTokenCount)?j:void 0,reasoningTokens:null!=(k=null==E?void 0:E.thoughtsTokenCount)?k:void 0,cachedInputTokens:null!=(l=null==E?void 0:E.cachedContentTokenCount)?l:void 0},warnings:t,providerMetadata:{google:{groundingMetadata:null!=(m=A.groundingMetadata)?m:null,urlContextMetadata:null!=(o=A.urlContextMetadata)?o:null,safetyRatings:null!=(q=A.safetyRatings)?q:null,usageMetadata:null!=E?E:null}},request:{body:u},response:{headers:w,body:z}}}async doStream(a){let b,c,{args:e,warnings:f}=await this.getArgs(a),g=JSON.stringify(e),i=(0,d.m2)(await (0,d.hd)(this.config.headers),a.headers),{responseHeaders:j,value:k}=await (0,d.GU)({url:`${this.config.baseURL}/${n(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:e,failedResponseHandler:h,successfulResponseHandler:(0,d.Ds)(C),abortSignal:a.abortSignal,fetch:this.config.fetch}),l="unknown",m={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},o=this.config.generateId,q=!1,r=null,s=null,t=0,u=new Set;return{stream:k.pipeThrough(new TransformStream({start(a){a.enqueue({type:"stream-start",warnings:f})},transform(d,e){var f,g,h,i,j,k,n,v,w,y,z,A;if(a.includeRawChunks&&e.enqueue({type:"raw",rawValue:d.rawValue}),!d.success)return void e.enqueue({type:"error",error:d.error});let B=d.value,C=B.usageMetadata;null!=C&&(m.inputTokens=null!=(f=C.promptTokenCount)?f:void 0,m.outputTokens=null!=(g=C.candidatesTokenCount)?g:void 0,m.totalTokens=null!=(h=C.totalTokenCount)?h:void 0,m.reasoningTokens=null!=(i=C.thoughtsTokenCount)?i:void 0,m.cachedInputTokens=null!=(j=C.cachedContentTokenCount)?j:void 0);let D=null==(k=B.candidates)?void 0:k[0];if(null==D)return;let E=D.content,F=x({groundingMetadata:D.groundingMetadata,generateId:o});if(null!=F)for(let a of F)"url"!==a.sourceType||u.has(a.url)||(u.add(a.url),e.enqueue(a));if(null!=E){for(let a of null!=(n=E.parts)?n:[])if("executableCode"in a&&(null==(v=a.executableCode)?void 0:v.code)){let c=o();b=c,e.enqueue({type:"tool-call",toolCallId:c,toolName:"code_execution",input:JSON.stringify(a.executableCode),providerExecuted:!0}),q=!0}else if("codeExecutionResult"in a&&a.codeExecutionResult){let c=b;c&&(e.enqueue({type:"tool-result",toolCallId:c,toolName:"code_execution",result:{outcome:a.codeExecutionResult.outcome,output:a.codeExecutionResult.output},providerExecuted:!0}),b=void 0)}else"text"in a&&null!=a.text&&a.text.length>0&&(!0===a.thought?(null!==r&&(e.enqueue({type:"text-end",id:r}),r=null),null===s&&(s=String(t++),e.enqueue({type:"reasoning-start",id:s,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})),e.enqueue({type:"reasoning-delta",id:s,delta:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})):(null!==s&&(e.enqueue({type:"reasoning-end",id:s}),s=null),null===r&&(r=String(t++),e.enqueue({type:"text-start",id:r,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})),e.enqueue({type:"text-delta",id:r,delta:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})));let a=null==(A=E.parts)?void 0:A.filter(a=>"inlineData"in a);if(null!=a)for(let b of a)e.enqueue({type:"file",mediaType:b.inlineData.mimeType,data:b.inlineData.data});let c=function({parts:a,generateId:b}){let c=null==a?void 0:a.filter(a=>"functionCall"in a);return null==c||0===c.length?void 0:c.map(a=>({type:"tool-call",toolCallId:b(),toolName:a.functionCall.name,args:JSON.stringify(a.functionCall.args),providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}))}({parts:E.parts,generateId:o});if(null!=c)for(let a of c)e.enqueue({type:"tool-input-start",id:a.toolCallId,toolName:a.toolName,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-input-delta",id:a.toolCallId,delta:a.args,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-input-end",id:a.toolCallId,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.args,providerMetadata:a.providerMetadata}),q=!0}null!=D.finishReason&&(l=p({finishReason:D.finishReason,hasToolCalls:q}),c={google:{groundingMetadata:null!=(w=D.groundingMetadata)?w:null,urlContextMetadata:null!=(y=D.urlContextMetadata)?y:null,safetyRatings:null!=(z=D.safetyRatings)?z:null}},null!=C&&(c.google.usageMetadata=C))},flush(a){null!==r&&a.enqueue({type:"text-end",id:r}),null!==s&&a.enqueue({type:"reasoning-end",id:s}),a.enqueue({type:"finish",finishReason:l,usage:m,providerMetadata:c})}})),response:{headers:j},request:{body:g}}}};function x({groundingMetadata:a,generateId:b}){var c;return null==(c=null==a?void 0:a.groundingChunks)?void 0:c.filter(a=>null!=a.web).map(a=>({type:"source",sourceType:"url",id:b(),url:a.web.uri,title:a.web.title}))}var y=f.Ik({parts:f.YO(f.KC([f.Ik({functionCall:f.Ik({name:f.Yj(),args:f.L5()}),thoughtSignature:f.Yj().nullish()}),f.Ik({inlineData:f.Ik({mimeType:f.Yj(),data:f.Yj()})}),f.Ik({executableCode:f.Ik({language:f.Yj(),code:f.Yj()}).nullish(),codeExecutionResult:f.Ik({outcome:f.Yj(),output:f.Yj()}).nullish(),text:f.Yj().nullish(),thought:f.zM().nullish(),thoughtSignature:f.Yj().nullish()})])).nullish()}),z=f.Ik({category:f.Yj().nullish(),probability:f.Yj().nullish(),probabilityScore:f.ai().nullish(),severity:f.Yj().nullish(),severityScore:f.ai().nullish(),blocked:f.zM().nullish()}),A=f.Ik({cachedContentTokenCount:f.ai().nullish(),thoughtsTokenCount:f.ai().nullish(),promptTokenCount:f.ai().nullish(),candidatesTokenCount:f.ai().nullish(),totalTokenCount:f.ai().nullish()}),B=f.Ik({candidates:f.YO(f.Ik({content:y.nullish().or(f.Ik({}).strict()),finishReason:f.Yj().nullish(),safetyRatings:f.YO(z).nullish(),groundingMetadata:r.nullish(),urlContextMetadata:u.nullish()})),usageMetadata:A.nullish()}),C=f.Ik({candidates:f.YO(f.Ik({content:y.nullish(),finishReason:f.Yj().nullish(),safetyRatings:f.YO(z).nullish(),groundingMetadata:r.nullish(),urlContextMetadata:u.nullish()})).nullish(),usageMetadata:A.nullish()}),D={googleSearch:s,urlContext:v,codeExecution:(0,d.J2)({id:"google.code_execution",name:"code_execution",inputSchema:f.Ik({language:f.Yj().describe("The programming language of the code."),code:f.Yj().describe("The code to be executed.")}),outputSchema:f.Ik({outcome:f.Yj().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:f.Yj().describe("The output from the code execution.")})})},E=class{constructor(a,b,c){this.modelId=a,this.settings=b,this.config=c,this.specificationVersion="v2"}get maxImagesPerCall(){var a;return null!=(a=this.settings.maxImagesPerCall)?a:4}get provider(){return this.config.provider}async doGenerate(a){var b,c,e;let{prompt:f,n:g=1,size:i="1024x1024",aspectRatio:j="1:1",seed:k,providerOptions:l,headers:m,abortSignal:n}=a,o=[];null!=i&&o.push({type:"unsupported-setting",setting:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),null!=k&&o.push({type:"unsupported-setting",setting:"seed",details:"This model does not support the `seed` option through this provider."});let p=await (0,d.xI)({provider:"google",providerOptions:l,schema:G}),q=null!=(e=null==(c=null==(b=this.config._internal)?void 0:b.currentDate)?void 0:c.call(b))?e:new Date,r={sampleCount:g};null!=j&&(r.aspectRatio=j),p&&Object.assign(r,p);let{responseHeaders:s,value:t}=await (0,d.GU)({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:(0,d.m2)(await (0,d.hd)(this.config.headers),m),body:{instances:[{prompt:f}],parameters:r},failedResponseHandler:h,successfulResponseHandler:(0,d.cV)(F),abortSignal:n,fetch:this.config.fetch});return{images:t.predictions.map(a=>a.bytesBase64Encoded),warnings:null!=o?o:[],providerMetadata:{google:{images:t.predictions.map(a=>({}))}},response:{timestamp:q,modelId:this.modelId,headers:s}}}},F=f.Ik({predictions:f.YO(f.Ik({bytesBase64Encoded:f.Yj()})).default([])}),G=f.Ik({personGeneration:f.k5(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:f.k5(["1:1","3:4","4:3","9:16","16:9"]).nullish()}),H=function(a={}){var b;let c=null!=(b=(0,d.ae)(a.baseURL))?b:"https://generativelanguage.googleapis.com/v1beta",e=()=>({"x-goog-api-key":(0,d.WL)({apiKey:a.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...a.headers}),f=b=>{var f;return new w(b,{provider:"google.generative-ai",baseURL:c,headers:e,generateId:null!=(f=a.generateId)?f:d.$C,supportedUrls:()=>({"*":[RegExp(`^${c}/files/.*$`),RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:a.fetch})},g=b=>new j(b,{provider:"google.generative-ai",baseURL:c,headers:e,fetch:a.fetch}),h=(b,d={})=>new E(b,d,{provider:"google.generative-ai",baseURL:c,headers:e,fetch:a.fetch}),i=function(a){if(new.target)throw Error("The Google Generative AI model function cannot be called with the new keyword.");return f(a)};return i.languageModel=f,i.chat=f,i.generativeAI=f,i.embedding=g,i.textEmbedding=g,i.textEmbeddingModel=g,i.image=h,i.imageModel=h,i.tools=D,i}(),I=c(42992);let J=H("models/gemini-1.5-flash-latest",{apiKey:process.env.GOOGLE_GENERATIVE_AI_API_KEY}),K=f.Ik({title:f.Yj(),summary:f.Yj(),tags:f.YO(f.Yj()),categories:f.YO(f.Yj()),sentiment:f.Yj(),keyPoints:f.YO(f.Yj())});async function L(a){let b=`You are an AI assistant that analyzes notes and extracts structured information.

Note content: "${a}"

Please analyze this content and provide:
1. A concise, descriptive title (not just the first few words)
2. A brief summary that captures the main ideas
3. 3-5 relevant tags/keywords
4. Appropriate categories
5. The overall sentiment
6. Key points mentioned

Make sure to actually analyze and summarize the content, not just repeat it.`;try{console.log("Calling AI analysis with prompt:",b.substring(0,200)+"...");let a=await (0,I.pY)({model:J,schema:K,prompt:b});return console.log("AI analysis successful:",a.object),a.object}catch(b){return console.error("AI analysis failed, using fallback:",b),{title:a.split(" ").slice(0,5).join(" ")+"...",summary:a.length>100?a.substring(0,100)+"...":a,tags:["note"],categories:["general"],sentiment:"neutral",keyPoints:[a]}}}f.Ik({intent:f.Yj(),keywords:f.YO(f.Yj()),filters:f.Ik({categories:f.YO(f.Yj()).optional(),tags:f.YO(f.Yj()).optional(),dateRange:f.Yj().optional()})})}};