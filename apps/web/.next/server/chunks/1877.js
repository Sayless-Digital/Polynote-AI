exports.id=1877,exports.ids=[1877],exports.modules={47870:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{Jw:()=>g.userAISettings,Jz:()=>g.emailVerificationTokens,Mf:()=>g.sessions,Q2:()=>g.notes,VV:()=>g.users,ZO:()=>g.attachments,db:()=>j,qp:()=>g.tokenUsageLogs});var e=c(10762),f=c(6989),g=c(60907),h=a([e,f]);[e,f]=h.then?(await h)():h;let i=(0,e.neon)(process.env.DATABASE_URL),j=(0,f.fd)(i,{schema:g});d()}catch(a){d(a)}})},5e4:(a,b,c)=>{"use strict";c.d(b,{U2:()=>g,X:()=>e,g9:()=>h,j0:()=>j,s4:()=>f,sj:()=>k,vt:()=>i});var d=c(91944),e=function(a){return a.SUMMARY="summary",a.KEY_POINTS="key_points",a.CATEGORIES="categories",a.TAGS="tags",a.SENTIMENT="sentiment",a.TITLE="title",a.ENTITIES="entities",a.TOPICS="topics",a.RELATIONSHIPS="relationships",a.CONFIDENCE_SCORE="confidence_score",a}({});let f=d.Ik({summary:d.Yj().min(10).max(1e3),confidence:d.ai().min(0).max(1),wordCount:d.ai().min(1),keyThemes:d.YO(d.Yj()).max(5),language:d.Yj().optional()}),g=d.Ik({keyPoints:d.YO(d.Ik({point:d.Yj().min(10).max(200),importance:d.ai().min(0).max(1),category:d.Yj().optional(),evidence:d.Yj().optional()})).min(1).max(10),totalPoints:d.ai().min(1),averageImportance:d.ai().min(0).max(1)}),h=d.Ik({categories:d.YO(d.Ik({name:d.Yj().min(2).max(50),confidence:d.ai().min(0).max(1),reasoning:d.Yj().optional(),subcategories:d.YO(d.Yj()).optional()})).min(1).max(5),primaryCategory:d.Yj().min(2).max(50),categoryHierarchy:d.YO(d.Yj()).optional()}),i=d.Ik({tags:d.YO(d.Ik({tag:d.Yj().min(2).max(30),relevance:d.ai().min(0).max(1),type:d.k5(["topic","entity","concept","action","emotion"]),frequency:d.ai().min(1).optional()})).min(1).max(15),tagCloud:d.g1(d.ai()).optional()}),j=d.Ik({sentiment:d.k5(["positive","negative","neutral","mixed"]),confidence:d.ai().min(0).max(1),emotions:d.YO(d.Ik({emotion:d.Yj(),intensity:d.ai().min(0).max(1)})).optional(),polarity:d.ai().min(-1).max(1)}),k=d.Ik({title:d.Yj().min(5).max(100),alternatives:d.YO(d.Yj()).max(3).optional(),confidence:d.ai().min(0).max(1),style:d.k5(["descriptive","question","statement","creative"]).optional()});d.Ik({entities:d.YO(d.Ik({name:d.Yj(),type:d.k5(["person","organization","location","date","product","concept"]),confidence:d.ai().min(0).max(1),mentions:d.ai().min(1),context:d.Yj().optional()})).min(0).max(20),entityRelationships:d.YO(d.Ik({entity1:d.Yj(),entity2:d.Yj(),relationship:d.Yj(),confidence:d.ai().min(0).max(1)})).optional()}),d.Ik({topics:d.YO(d.Ik({topic:d.Yj().min(3).max(50),relevance:d.ai().min(0).max(1),subtopics:d.YO(d.Yj()).optional(),keywords:d.YO(d.Yj()).optional()})).min(1).max(8),topicDistribution:d.g1(d.ai()).optional()}),d.Ik({relationships:d.YO(d.Ik({source:d.Yj(),target:d.Yj(),relationship:d.Yj(),strength:d.ai().min(0).max(1),type:d.k5(["causal","temporal","hierarchical","associative","contrastive"])})).min(0).max(15),relationshipGraph:d.g1(d.YO(d.Yj())).optional()}),d.Ik({overallConfidence:d.ai().min(0).max(1),analysisBreakdown:d.g1(d.ai()),qualityIndicators:d.Ik({contentLength:d.zM(),clarity:d.zM(),coherence:d.zM(),completeness:d.zM()}),recommendations:d.YO(d.Yj()).optional()})},60907:(a,b,c)=>{"use strict";c.r(b),c.d(b,{attachments:()=>s,attachmentsRelations:()=>y,emailVerificationTokens:()=>p,emailVerificationTokensRelations:()=>v,noteSearches:()=>r,noteSearchesRelations:()=>x,notes:()=>q,notesRelations:()=>w,sessions:()=>o,sessionsRelations:()=>u,tokenUsageLogs:()=>A,userAISettings:()=>z,users:()=>n,usersRelations:()=>t});var d=c(40728),e=c(32896),f=c(71350),g=c(7268),h=c(43823),i=c(39595),j=c(72099),k=c(34527),l=c(51453),m=c(77988);let n=(0,d.cJ)("users",{id:(0,e.uR)("id").primaryKey().defaultRandom(),email:(0,f.yf)("email",{length:255}).notNull().unique(),name:(0,g.Qq)("name").notNull(),passwordHash:(0,g.Qq)("password_hash").notNull(),emailVerified:(0,h.zM)("email_verified").default(!1).notNull(),avatar:(0,g.Qq)("avatar"),preferences:(0,i.Fx)("preferences").$type(),resetToken:(0,g.Qq)("reset_token"),resetTokenExpiry:(0,j.vE)("reset_token_expiry"),createdAt:(0,j.vE)("created_at").defaultNow().notNull(),updatedAt:(0,j.vE)("updated_at").defaultNow().notNull()},a=>({emailIdx:(0,k.Pe)("users_email_idx").on(a.email),createdAtIdx:(0,k.Pe)("users_created_at_idx").on(a.createdAt),resetTokenIdx:(0,k.Pe)("users_reset_token_idx").on(a.resetToken)})),o=(0,d.cJ)("sessions",{id:(0,e.uR)("id").primaryKey().defaultRandom(),userId:(0,e.uR)("user_id").references(()=>n.id,{onDelete:"cascade"}).notNull(),token:(0,g.Qq)("token").notNull().unique(),expiresAt:(0,j.vE)("expires_at").notNull(),createdAt:(0,j.vE)("created_at").defaultNow().notNull()},a=>({userIdIdx:(0,k.Pe)("sessions_user_id_idx").on(a.userId),tokenIdx:(0,k.Pe)("sessions_token_idx").on(a.token),expiresAtIdx:(0,k.Pe)("sessions_expires_at_idx").on(a.expiresAt)})),p=(0,d.cJ)("email_verification_tokens",{id:(0,e.uR)("id").primaryKey().defaultRandom(),userId:(0,e.uR)("user_id").references(()=>n.id,{onDelete:"cascade"}).notNull(),token:(0,g.Qq)("token").notNull().unique(),expiresAt:(0,j.vE)("expires_at").notNull(),createdAt:(0,j.vE)("created_at").defaultNow().notNull()},a=>({userIdIdx:(0,k.Pe)("email_verification_tokens_user_id_idx").on(a.userId),tokenIdx:(0,k.Pe)("email_verification_tokens_token_idx").on(a.token),expiresAtIdx:(0,k.Pe)("email_verification_tokens_expires_at_idx").on(a.expiresAt)})),q=(0,d.cJ)("notes",{id:(0,e.uR)("id").primaryKey().defaultRandom(),userId:(0,e.uR)("user_id").references(()=>n.id,{onDelete:"cascade"}).notNull(),title:(0,g.Qq)("title").notNull(),content:(0,g.Qq)("content").notNull(),transcript:(0,g.Qq)("transcript"),summary:(0,g.Qq)("summary"),tags:(0,i.Fx)("tags").$type(),categories:(0,i.Fx)("categories").$type(),metadata:(0,i.Fx)("metadata").$type(),isPublic:(0,h.zM)("is_public").default(!1).notNull(),createdAt:(0,j.vE)("created_at").defaultNow().notNull(),updatedAt:(0,j.vE)("updated_at").defaultNow().notNull()},a=>({userIdIdx:(0,k.Pe)("notes_user_id_idx").on(a.userId),titleIdx:(0,k.Pe)("notes_title_idx").on(a.title),createdAtIdx:(0,k.Pe)("notes_created_at_idx").on(a.createdAt),tagsIdx:(0,k.Pe)("notes_tags_idx").on(a.tags),categoriesIdx:(0,k.Pe)("notes_categories_idx").on(a.categories),isPublicIdx:(0,k.Pe)("notes_is_public_idx").on(a.isPublic)})),r=(0,d.cJ)("note_searches",{id:(0,e.uR)("id").primaryKey().defaultRandom(),noteId:(0,e.uR)("note_id").references(()=>q.id,{onDelete:"cascade"}),searchVector:(0,g.Qq)("search_vector"),createdAt:(0,j.vE)("created_at").defaultNow().notNull()}),s=(0,d.cJ)("attachments",{id:(0,e.uR)("id").primaryKey().defaultRandom(),noteId:(0,e.uR)("note_id").references(()=>q.id,{onDelete:"cascade"}).notNull(),filename:(0,g.Qq)("filename").notNull(),originalName:(0,g.Qq)("original_name").notNull(),size:(0,g.Qq)("size").notNull(),type:(0,g.Qq)("type").notNull(),url:(0,g.Qq)("url").notNull(),content:(0,g.Qq)("content"),createdAt:(0,j.vE)("created_at").defaultNow().notNull()},a=>({noteIdIdx:(0,k.Pe)("attachments_note_id_idx").on(a.noteId),createdAtIdx:(0,k.Pe)("attachments_created_at_idx").on(a.createdAt)})),t=(0,m.K1)(n,({many:a})=>({notes:a(q),sessions:a(o),emailVerificationTokens:a(p)})),u=(0,m.K1)(o,({one:a})=>({user:a(n,{fields:[o.userId],references:[n.id]})})),v=(0,m.K1)(p,({one:a})=>({user:a(n,{fields:[p.userId],references:[n.id]})})),w=(0,m.K1)(q,({one:a,many:b})=>({user:a(n,{fields:[q.userId],references:[n.id]}),searches:b(r),attachments:b(s)})),x=(0,m.K1)(r,({one:a})=>({note:a(q,{fields:[r.noteId],references:[q.id]})})),y=(0,m.K1)(s,({one:a})=>({note:a(q,{fields:[s.noteId],references:[q.id]})})),z=(0,d.cJ)("user_ai_settings",{id:(0,e.uR)("id").primaryKey().defaultRandom(),userId:(0,e.uR)("user_id").references(()=>n.id,{onDelete:"cascade"}).notNull(),provider:(0,f.yf)("provider",{length:50}).notNull().default("google"),apiKey:(0,g.Qq)("api_key"),model:(0,f.yf)("model",{length:100}).notNull().default("gemini-1.5-flash-latest"),totalTokensUsed:(0,l.nd)("total_tokens_used").default(0).notNull(),totalRequests:(0,l.nd)("total_requests").default(0).notNull(),lastUsedAt:(0,j.vE)("last_used_at"),enabledAnalyses:(0,i.Fx)("enabled_analyses").$type().default(["title","summary","key_points","categories","tags"]),analysisTimeout:(0,l.nd)("analysis_timeout").default(3e4),cacheEnabled:(0,h.zM)("cache_enabled").default(!0),cacheTTL:(0,l.nd)("cache_ttl").default(86400),createdAt:(0,j.vE)("created_at").defaultNow().notNull(),updatedAt:(0,j.vE)("updated_at").defaultNow().notNull()},a=>({userIdIdx:(0,k.Pe)("user_ai_settings_user_id_idx").on(a.userId),providerIdx:(0,k.Pe)("user_ai_settings_provider_idx").on(a.provider),lastUsedIdx:(0,k.Pe)("user_ai_settings_last_used_idx").on(a.lastUsedAt)})),A=(0,d.cJ)("token_usage_logs",{id:(0,e.uR)("id").primaryKey().defaultRandom(),userId:(0,e.uR)("user_id").references(()=>n.id,{onDelete:"cascade"}).notNull(),noteId:(0,e.uR)("note_id"),provider:(0,f.yf)("provider",{length:50}).notNull(),model:(0,f.yf)("model",{length:100}).notNull(),analysisType:(0,f.yf)("analysis_type",{length:50}).notNull(),inputTokens:(0,l.nd)("input_tokens").default(0).notNull(),outputTokens:(0,l.nd)("output_tokens").default(0).notNull(),totalTokens:(0,l.nd)("total_tokens").default(0).notNull(),requestDuration:(0,l.nd)("request_duration"),success:(0,h.zM)("success").default(!0).notNull(),errorMessage:(0,g.Qq)("error_message"),estimatedCost:(0,l.nd)("estimated_cost"),createdAt:(0,j.vE)("created_at").defaultNow().notNull()},a=>({userIdIdx:(0,k.Pe)("token_usage_logs_user_id_idx").on(a.userId),noteIdIdx:(0,k.Pe)("token_usage_logs_note_id_idx").on(a.noteId),createdAtIdx:(0,k.Pe)("token_usage_logs_created_at_idx").on(a.createdAt),providerIdx:(0,k.Pe)("token_usage_logs_provider_idx").on(a.provider)}))},80408:()=>{},87032:()=>{},93397:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{DK:()=>k,FU:()=>m,On:()=>l,Wc:()=>n});var e=c(47870),f=c(81796),g=c(55511),h=c.n(g),i=a([e]);e=(i.then?(await i)():i)[0];let o=process.env.API_KEY_ENCRYPTION_KEY||"default-encryption-key-change-in-production",p="aes-256-gcm";function j(a){let b=a.split(":");Buffer.from(b[0],"hex");let c=b[1],d=h().createDecipher(p,o),e=d.update(c,"hex","utf8");return e+=d.final("utf8")}async function k(a){try{let[b]=await e.db.select().from(e.Jw).where((0,f.eq)(e.Jw.userId,a)).limit(1);return b&&b.apiKey&&(b.apiKey=j(b.apiKey)),b||null}catch(a){return console.error("Error getting user AI settings:",a),null}}async function l(a,b){try{let c=await k(a),d={userId:a,provider:b.provider||"google",apiKey:b.apiKey?function(a){let b=h().randomBytes(16),c=h().createCipher(p,o),d=c.update(a,"utf8","hex");return d+=c.final("hex"),b.toString("hex")+":"+d}(b.apiKey):c?.apiKey,model:b.model||"gemini-1.5-flash-latest",enabledAnalyses:b.enabledAnalyses||["title","summary","key_points","categories","tags"],analysisTimeout:b.analysisTimeout||3e4,cacheEnabled:void 0===b.cacheEnabled||b.cacheEnabled,cacheTTL:b.cacheTTL||86400,updatedAt:new Date};if(c){let[b]=await e.db.update(e.Jw).set(d).where((0,f.eq)(e.Jw.userId,a)).returning();return b&&b.apiKey&&(b.apiKey=j(b.apiKey)),b}{let[a]=await e.db.insert(e.Jw).values(d).returning();return a&&a.apiKey&&(a.apiKey=j(a.apiKey)),a}}catch(a){return console.error("Error upserting user AI settings:",a),null}}async function m(a,b){try{let c={userId:a,noteId:b.noteId,provider:b.provider,model:b.model,analysisType:b.analysisType,inputTokens:b.inputTokens,outputTokens:b.outputTokens,totalTokens:b.totalTokens,requestDuration:b.requestDuration,success:b.success,errorMessage:b.errorMessage,estimatedCost:b.estimatedCost};await e.db.insert(e.qp).values(c),b.success&&await e.db.update(e.Jw).set({totalTokensUsed:e.db.sql`${e.Jw.totalTokensUsed} + ${b.totalTokens}`,totalRequests:e.db.sql`${e.Jw.totalRequests} + 1`,lastUsedAt:new Date}).where((0,f.eq)(e.Jw.userId,a))}catch(a){console.error("Error logging token usage:",a)}}async function n(a,b=30){try{let c=new Date;c.setDate(c.getDate()-b);let d=await e.db.select().from(e.qp).where((0,f.eq)(e.qp.userId,a)),g={totalRequests:d.length,totalTokens:d.reduce((a,b)=>a+b.totalTokens,0),totalInputTokens:d.reduce((a,b)=>a+b.inputTokens,0),totalOutputTokens:d.reduce((a,b)=>a+b.outputTokens,0),successfulRequests:d.filter(a=>a.success).length,failedRequests:d.filter(a=>!a.success).length,averageRequestDuration:d.reduce((a,b)=>a+(b.requestDuration||0),0)/d.length,estimatedTotalCost:d.reduce((a,b)=>a+(b.estimatedCost||0),0),byProvider:{},byModel:{},byAnalysisType:{}};return d.forEach(a=>{g.byProvider[a.provider]||(g.byProvider[a.provider]={requests:0,tokens:0,cost:0}),g.byProvider[a.provider].requests++,g.byProvider[a.provider].tokens+=a.totalTokens,g.byProvider[a.provider].cost+=a.estimatedCost||0}),d.forEach(a=>{g.byModel[a.model]||(g.byModel[a.model]={requests:0,tokens:0,cost:0}),g.byModel[a.model].requests++,g.byModel[a.model].tokens+=a.totalTokens,g.byModel[a.model].cost+=a.estimatedCost||0}),d.forEach(a=>{g.byAnalysisType[a.analysisType]||(g.byAnalysisType[a.analysisType]={requests:0,tokens:0,cost:0}),g.byAnalysisType[a.analysisType].requests++,g.byAnalysisType[a.analysisType].tokens+=a.totalTokens,g.byAnalysisType[a.analysisType].cost+=a.estimatedCost||0}),g}catch(a){return console.error("Error getting user token usage:",a),null}}d()}catch(a){d(a)}})},94664:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{T:()=>h});var e=c(8443),f=c(93397),g=a([f]);f=(g.then?(await g)():g)[0];class h{async initialize(a){this.userSettings=await (0,f.DK)(a),this.userSettings?.provider==="google"&&this.userSettings?.apiKey?this.model=(0,e.q)(this.userSettings.model,{apiKey:this.userSettings.apiKey}):this.model=(0,e.q)("models/gemini-1.5-flash-latest",{apiKey:process.env.GOOGLE_GENERATIVE_AI_API_KEY})}validateContent(a){return!!a&&!(a.trim().length<10)}createBaseResult(a,b,c,d,e){return{id:`${a}_${this.type}_${Date.now()}`,noteId:a,type:this.type,status:b,result:c,error:d,createdAt:new Date,updatedAt:new Date,processingTime:e}}async executeWithTimeout(a,b=this.timeout){return Promise.race([a(),new Promise((a,c)=>setTimeout(()=>c(Error(`Analysis timeout after ${b}ms`)),b))])}async logMetrics(a,b,c,d,e,g,h){console.log(`[${this.type.toUpperCase()}] Analysis completed:`,{noteId:a,processingTime:`${b}ms`,success:c,error:d,timestamp:new Date().toISOString()}),this.userSettings&&e&&void 0!==g&&void 0!==h&&await (0,f.FU)(e,{noteId:a,provider:this.userSettings.provider,model:this.userSettings.model,analysisType:this.type,inputTokens:g,outputTokens:h,totalTokens:g+h,requestDuration:b,success:c,errorMessage:d})}estimateInputTokens(a){return Math.ceil(a.length/4)}estimateOutputTokens(a){let b=JSON.stringify(a);return Math.ceil(b.length/4)}getPriority(){return this.priority}isEnabled(a){return a.includes(this.type)}constructor(){this.userSettings=null}}d()}catch(a){d(a)}})}};